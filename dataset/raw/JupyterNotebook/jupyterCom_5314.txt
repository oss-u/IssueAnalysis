[
  {
    "url": "https://api.github.com/repos/jupyter/notebook/issues/comments/605349376",
    "html_url": "https://github.com/jupyter/notebook/issues/5314#issuecomment-605349376",
    "issue_url": "https://api.github.com/repos/jupyter/notebook/issues/5314",
    "id": 605349376,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYwNTM0OTM3Ng==",
    "user": {
      "login": "yangyishan0901m",
      "id": 26148202,
      "node_id": "MDQ6VXNlcjI2MTQ4MjAy",
      "avatar_url": "https://avatars.githubusercontent.com/u/26148202?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/yangyishan0901m",
      "html_url": "https://github.com/yangyishan0901m",
      "followers_url": "https://api.github.com/users/yangyishan0901m/followers",
      "following_url": "https://api.github.com/users/yangyishan0901m/following{/other_user}",
      "gists_url": "https://api.github.com/users/yangyishan0901m/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/yangyishan0901m/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/yangyishan0901m/subscriptions",
      "organizations_url": "https://api.github.com/users/yangyishan0901m/orgs",
      "repos_url": "https://api.github.com/users/yangyishan0901m/repos",
      "events_url": "https://api.github.com/users/yangyishan0901m/events{/privacy}",
      "received_events_url": "https://api.github.com/users/yangyishan0901m/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-03-27T23:02:22Z",
    "updated_at": "2020-03-27T23:02:22Z",
    "author_association": "NONE",
    "body": "After switch, I run /api/sessions and /api/kernels, both are empty, since the switch will delete kernel and session first and create new one with new kernel type. Notebook will be in a unusable state.",
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/jupyter/notebook/issues/comments/606112830",
    "html_url": "https://github.com/jupyter/notebook/issues/5314#issuecomment-606112830",
    "issue_url": "https://api.github.com/repos/jupyter/notebook/issues/5314",
    "id": 606112830,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYwNjExMjgzMA==",
    "user": {
      "login": "kevin-bates",
      "id": 22599560,
      "node_id": "MDQ6VXNlcjIyNTk5NTYw",
      "avatar_url": "https://avatars.githubusercontent.com/u/22599560?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/kevin-bates",
      "html_url": "https://github.com/kevin-bates",
      "followers_url": "https://api.github.com/users/kevin-bates/followers",
      "following_url": "https://api.github.com/users/kevin-bates/following{/other_user}",
      "gists_url": "https://api.github.com/users/kevin-bates/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/kevin-bates/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/kevin-bates/subscriptions",
      "organizations_url": "https://api.github.com/users/kevin-bates/orgs",
      "repos_url": "https://api.github.com/users/kevin-bates/repos",
      "events_url": "https://api.github.com/users/kevin-bates/events{/privacy}",
      "received_events_url": "https://api.github.com/users/kevin-bates/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-03-30T16:45:51Z",
    "updated_at": "2020-03-30T16:45:51Z",
    "author_association": "MEMBER",
    "body": "Hmm - I'm not reproducing this issue.  The output is produced by hitting the `/api/kernels` and `/api/sessions` endpoints against the Notebook server (not EG) follow each kernel switch - which I believe equates to your scenario:\r\n```\r\nA\r\n[{\"id\": \"8fcdba00-2ec4-4e4a-95e6-065411863e9d\", \"name\": \"python3\", \"last_activity\": \"2020-03-30T16:25:44.165278Z\", \"execution_state\": \"idle\", \"connections\": 1}]\r\n[{\"id\": \"0d9b2d3f-24f8-49b5-96a2-38052ad6b7ba\", \"path\": \"Untitled1.ipynb\", \"name\": \"\", \"type\": \"notebook\", \"kernel\": {\"id\": \"8fcdba00-2ec4-4e4a-95e6-065411863e9d\", \"name\": \"python3\", \"last_activity\": \"2020-03-30T16:25:44.165278Z\", \"execution_state\": \"idle\", \"connections\": 1}, \"notebook\": {\"path\": \"Untitled1.ipynb\", \"name\": \"\"}}]\r\n\r\nB\r\n[{\"id\": \"0b28fe93-180b-4d77-80d2-a997310f1498\", \"name\": \"spark_python_yarn_cluster\", \"last_activity\": \"2020-03-30T16:26:42.371571Z\", \"execution_state\": \"starting\", \"connections\": 0}]\r\n[{\"id\": \"64eb50cd-84ad-4197-b1e9-7abf4e662632\", \"path\": \"Untitled1.ipynb\", \"name\": \"\", \"type\": \"notebook\", \"kernel\": {\"id\": \"0b28fe93-180b-4d77-80d2-a997310f1498\", \"name\": \"spark_python_yarn_cluster\", \"last_activity\": \"2020-03-30T16:26:43.497512Z\", \"execution_state\": \"idle\", \"connections\": 1}, \"notebook\": {\"path\": \"Untitled1.ipynb\", \"name\": \"\"}}]\r\n\r\nA\r\n[{\"id\": \"5089313f-f45c-4dc1-920a-e4364a257deb\", \"name\": \"python3\", \"last_activity\": \"2020-03-30T16:27:10.601975Z\", \"execution_state\": \"idle\", \"connections\": 1}]\r\n[{\"id\": \"04a93974-dfa2-4298-9afd-015792de2227\", \"path\": \"Untitled1.ipynb\", \"name\": \"\", \"type\": \"notebook\", \"kernel\": {\"id\": \"5089313f-f45c-4dc1-920a-e4364a257deb\", \"name\": \"python3\", \"last_activity\": \"2020-03-30T16:27:10.601975Z\", \"execution_state\": \"idle\", \"connections\": 1}, \"notebook\": {\"path\": \"Untitled1.ipynb\", \"name\": \"\"}}]\r\n```\r\n\r\nI also see the deletion issue surrounding the cache_ports boolean as I'm using an unpatched EG, but still can't reproduce this.\r\n\r\n> this async bug\r\n\r\nJust to clarify, this isn't an issue with async per se (as in async/await), but more of a race condition.  Is that what you mean?  If so, we may want to replace `async issue` in the title with `race condition` so it isn't confused with async/await behaviors - which are taking place on the repo and in jupyter_client lately.\r\n\r\nQuestions:\r\n1.  How long do your remote kernels take to fully start (i.e., are available to execute commands)?\r\n2. Are you switching back from B to A ahead of B's startup completion?",
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/jupyter/notebook/issues/comments/606206854",
    "html_url": "https://github.com/jupyter/notebook/issues/5314#issuecomment-606206854",
    "issue_url": "https://api.github.com/repos/jupyter/notebook/issues/5314",
    "id": 606206854,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYwNjIwNjg1NA==",
    "user": {
      "login": "yangyishan0901m",
      "id": 26148202,
      "node_id": "MDQ6VXNlcjI2MTQ4MjAy",
      "avatar_url": "https://avatars.githubusercontent.com/u/26148202?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/yangyishan0901m",
      "html_url": "https://github.com/yangyishan0901m",
      "followers_url": "https://api.github.com/users/yangyishan0901m/followers",
      "following_url": "https://api.github.com/users/yangyishan0901m/following{/other_user}",
      "gists_url": "https://api.github.com/users/yangyishan0901m/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/yangyishan0901m/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/yangyishan0901m/subscriptions",
      "organizations_url": "https://api.github.com/users/yangyishan0901m/orgs",
      "repos_url": "https://api.github.com/users/yangyishan0901m/repos",
      "events_url": "https://api.github.com/users/yangyishan0901m/events{/privacy}",
      "received_events_url": "https://api.github.com/users/yangyishan0901m/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-03-30T19:45:30Z",
    "updated_at": "2020-03-30T19:47:03Z",
    "author_association": "NONE",
    "body": "For question \r\n1. Remote kernel will take around 5 to 10 sec to start.\r\n2. I did not do fast switch, I will wait switch kernel finished then do next switch.  \r\nI added log around https://github.com/jupyter/notebook/blame/master/notebook/services/sessions/handlers.py#L64, and I think the EG exception will hide the issue I mentioned. Could you please try to patch EG? I tried locally and without patch, and EG won't really delete remote kernel, and it just return 500 error. So that, the jupyter will reuse the old kernel. And I apply patch(which already in EG mainline) to fix cache port bug. The kernel can be deleted successfully. And I start see the issue I described. I believe after EG release new version, this issue will be revealed. \r\nSorry for the confusion naming, since I don't know what the root cause, and I thought it is some async issue between database deletion and commit.\r\n\r\nHere is the log I saw. And I add log to confirm session id is deleted in database.\r\ndelete session1 and delete session2, and exists is true even session id has been removed from database. And finally, get session api return 404, which cause notebook in state without any session and kernel.\r\n```\r\n[I 12:42:19.601 NotebookApp] Connecting to wss://localhost:18888/api/kernels/c4333d11-e43b-4683-9ccd-d887daa3f39f/channels\r\ngetAllsession\r\n[W 12:42:20.564 NotebookApp] Websocket connection has been closed via client disconnect or due to error.  Kernel with ID 'c4333d11-e43b-4683-9ccd-d887daa3f39f' may not be terminated on GatewayClient: https://localhost:18888\r\n[I 12:42:20.564 NotebookApp] Attempting to re-establish the connection to Gateway: c4333d11-e43b-4683-9ccd-d887daa3f39f\r\n[I 12:42:20.564 NotebookApp] Connecting to wss://localhost:18888/api/kernels/c4333d11-e43b-4683-9ccd-d887daa3f39f/channels\r\n[W 12:42:20.589 NotebookApp] Websocket connection has been closed via client disconnect or due to error.  Kernel with ID 'c4333d11-e43b-4683-9ccd-d887daa3f39f' may not be terminated on GatewayClient: https://localhost:18888\r\npostAllsession\r\nfirst:False\r\ncreate session1:Untitled1.ipynb\r\n[I 12:42:22.938 NotebookApp] Request start kernel: kernel_id=None, path=\"\"\r\n[I 12:42:23.836 NotebookApp] Kernel started: 8d93e1a6-3dfb-4058-b4cb-c126510cc4d9\r\nget_session:<sqlite3.Row object at 0x10b51ac50>\r\n[I 12:42:25.187 NotebookApp] Connecting to wss://localhost:18888/api/kernels/8d93e1a6-3dfb-4058-b4cb-c126510cc4d9/channels\r\ndelete one session:dea09da9-d720-4fd4-80ff-b0093ee4bf91\r\nget_session:<sqlite3.Row object at 0x10b7ffe70>\r\n[I 12:42:27.352 NotebookApp] Saving file at /Untitled1.ipynb\r\npostAllsession\r\ndelete session1:dea09da9-d720-4fd4-80ff-b0093ee4bf91\r\ndelete session2:dea09da9-d720-4fd4-80ff-b0093ee4bf91\r\n[W 12:42:30.282 NotebookApp] Kernel not found at: https://localhost:18888/api/kernels/8d93e1a6-3dfb-4058-b4cb-c126510cc4d9\r\nfirst:True\r\nalready exists1:Untitled1.ipynb\r\n[W 12:42:30.282 NotebookApp] 404 POST /api/sessions (::1): Session not found: path='Untitled1.ipynb'\r\n[W 12:42:30.283 NotebookApp] Session not found: path='Untitled1.ipynb'\r\n[W 12:42:30.283 NotebookApp] 404 POST /api/sessions (::1) 1720.57ms referer=http://localhost:8889/notebooks/Untitled1.ipynb\r\n```",
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/jupyter/notebook/issues/comments/606255385",
    "html_url": "https://github.com/jupyter/notebook/issues/5314#issuecomment-606255385",
    "issue_url": "https://api.github.com/repos/jupyter/notebook/issues/5314",
    "id": 606255385,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYwNjI1NTM4NQ==",
    "user": {
      "login": "kevin-bates",
      "id": 22599560,
      "node_id": "MDQ6VXNlcjIyNTk5NTYw",
      "avatar_url": "https://avatars.githubusercontent.com/u/22599560?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/kevin-bates",
      "html_url": "https://github.com/kevin-bates",
      "followers_url": "https://api.github.com/users/kevin-bates/followers",
      "following_url": "https://api.github.com/users/kevin-bates/following{/other_user}",
      "gists_url": "https://api.github.com/users/kevin-bates/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/kevin-bates/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/kevin-bates/subscriptions",
      "organizations_url": "https://api.github.com/users/kevin-bates/orgs",
      "repos_url": "https://api.github.com/users/kevin-bates/repos",
      "events_url": "https://api.github.com/users/kevin-bates/events{/privacy}",
      "received_events_url": "https://api.github.com/users/kevin-bates/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-03-30T21:18:55Z",
    "updated_at": "2020-03-30T22:31:48Z",
    "author_association": "MEMBER",
    "body": "I'm sorry, but I still cannot reproduce this.  Here's what I'm doing...\r\n1. Start kernel 'Python 3' and wait for it to fully start (hollow circle next to kernel name).\r\n    a. Capture /api/sessions against Notebook server.\r\n2. Using the 'Change kernel' menu, change kernel to 'Spark - Python (YARN Cluster Mode)' and wait for it to fully start (5 - 10 secs)\r\n    a. Capture /api/sessions against Notebook server.\r\n3. Using the 'Change kernel' menu, change kernel to 'Python 3' and wait for it to fully start.\r\n    a. Capture /api/sessions against Notebook server.\r\n\r\nAre you encountering empty results on step 3a or both 2a and 3a?  I see complete and proper outputs on all three steps.\r\n\r\nCan you please start Notebook and EG with `--debug`. It might be helpful to compare Notebook console outputs.\r\n\r\nI'm also not seeing any of these?\r\n```\r\n[W 12:42:20.564 NotebookApp] Websocket connection has been closed via client disconnect or due to error.  Kernel with ID 'c4333d11-e43b-4683-9ccd-d887daa3f39f' may not be terminated on GatewayClient: https://localhost:18888\r\n[I 12:42:20.564 NotebookApp] Attempting to re-establish the connection to Gateway: c4333d11-e43b-4683-9ccd-d887daa3f39f\r\n[I 12:42:20.564 NotebookApp] Connecting to wss://localhost:18888/api/kernels/c4333d11-e43b-4683-9ccd-d887daa3f39f/channels\r\n[W 12:42:20.589 NotebookApp] Websocket connection has been closed via client disconnect or due to error.  Kernel with ID 'c4333d11-e43b-4683-9ccd-d887daa3f39f' may not be terminated on GatewayClient: https://localhost:18888\r\n```\r\nI do see that your EG is local to your Notebook server.  I will try that configuration next.  My current configuration has EG on a node of my YARN cluster with Notebook on my desktop.  Perhaps the two Notebook instances are colliding on your system.  (Total conjecture at this point)\r\n\r\nEDIT: Still unable to reproduce the issue when EG and Notebook are on the same node.  We must be doing something different from each other.",
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/jupyter/notebook/issues/comments/606862717",
    "html_url": "https://github.com/jupyter/notebook/issues/5314#issuecomment-606862717",
    "issue_url": "https://api.github.com/repos/jupyter/notebook/issues/5314",
    "id": 606862717,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYwNjg2MjcxNw==",
    "user": {
      "login": "kevin-bates",
      "id": 22599560,
      "node_id": "MDQ6VXNlcjIyNTk5NTYw",
      "avatar_url": "https://avatars.githubusercontent.com/u/22599560?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/kevin-bates",
      "html_url": "https://github.com/kevin-bates",
      "followers_url": "https://api.github.com/users/kevin-bates/followers",
      "following_url": "https://api.github.com/users/kevin-bates/following{/other_user}",
      "gists_url": "https://api.github.com/users/kevin-bates/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/kevin-bates/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/kevin-bates/subscriptions",
      "organizations_url": "https://api.github.com/users/kevin-bates/orgs",
      "repos_url": "https://api.github.com/users/kevin-bates/repos",
      "events_url": "https://api.github.com/users/kevin-bates/events{/privacy}",
      "received_events_url": "https://api.github.com/users/kevin-bates/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-03-31T20:40:30Z",
    "updated_at": "2020-03-31T20:40:30Z",
    "author_association": "MEMBER",
    "body": "Hi @yangyishan0901m - did you discover something different that caused things to work?  If not, I'm happy to help investigate, although it might be best to open an issue in the [EG repo](https://github.com/jupyter/enterprise_gateway/issues) since this appears to be specific to that. Thanks.",
    "performed_via_github_app": null
  }
]
