[
  {
    "url": "https://api.github.com/repos/jupyter/notebook/issues/comments/373423190",
    "html_url": "https://github.com/jupyter/notebook/pull/3424#issuecomment-373423190",
    "issue_url": "https://api.github.com/repos/jupyter/notebook/issues/3424",
    "id": 373423190,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM3MzQyMzE5MA==",
    "user": {
      "login": "takluyver",
      "id": 327925,
      "node_id": "MDQ6VXNlcjMyNzkyNQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/327925?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/takluyver",
      "html_url": "https://github.com/takluyver",
      "followers_url": "https://api.github.com/users/takluyver/followers",
      "following_url": "https://api.github.com/users/takluyver/following{/other_user}",
      "gists_url": "https://api.github.com/users/takluyver/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/takluyver/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/takluyver/subscriptions",
      "organizations_url": "https://api.github.com/users/takluyver/orgs",
      "repos_url": "https://api.github.com/users/takluyver/repos",
      "events_url": "https://api.github.com/users/takluyver/events{/privacy}",
      "received_events_url": "https://api.github.com/users/takluyver/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-03-15T15:46:01Z",
    "updated_at": "2018-03-15T15:46:01Z",
    "author_association": "MEMBER",
    "body": "I don't immediately see why this would result in a leak; the kernel object itself is deleted shortly afterwards (the `super(...).shutdown_kernel()` call calls `.remove_kernel()`, which removes it from the `{id: kernel}` dictionary. The kernel object (which is a KernelManager instance) should be garbage collected, and its `_activity_stream` should be cleaned up.\r\n\r\nWhat am I missing?",
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/jupyter/notebook/issues/comments/373457687",
    "html_url": "https://github.com/jupyter/notebook/pull/3424#issuecomment-373457687",
    "issue_url": "https://api.github.com/repos/jupyter/notebook/issues/3424",
    "id": 373457687,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM3MzQ1NzY4Nw==",
    "user": {
      "login": "kevin-bates",
      "id": 22599560,
      "node_id": "MDQ6VXNlcjIyNTk5NTYw",
      "avatar_url": "https://avatars.githubusercontent.com/u/22599560?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/kevin-bates",
      "html_url": "https://github.com/kevin-bates",
      "followers_url": "https://api.github.com/users/kevin-bates/followers",
      "following_url": "https://api.github.com/users/kevin-bates/following{/other_user}",
      "gists_url": "https://api.github.com/users/kevin-bates/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/kevin-bates/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/kevin-bates/subscriptions",
      "organizations_url": "https://api.github.com/users/kevin-bates/orgs",
      "repos_url": "https://api.github.com/users/kevin-bates/repos",
      "events_url": "https://api.github.com/users/kevin-bates/events{/privacy}",
      "received_events_url": "https://api.github.com/users/kevin-bates/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-03-15T17:25:01Z",
    "updated_at": "2018-03-15T17:25:01Z",
    "author_association": "MEMBER",
    "body": "@takluyver - thanks for the response.  I agree that its quite non-obvious.  However, w/o this statement, the iopub object *wrapper* created [here](https://github.com/jupyter/notebook/blob/master/notebook/services/kernels/kernelmanager.py#L364) will not be garbage collected - with a new (leaked) instance persisted across each subsequent kernel cycle.\r\n\r\nI found this and the two PRs ([360](https://github.com/jupyter/jupyter_client/pull/360), [361](https://github.com/jupyter/jupyter_client/pull/361)) submitted to jupyter_client via use of `gc.collect`, `gc.garbage` and `gc.get_referrers` calls in the `start_kernel()` and `shutdown_kernel()` methods of jupyter_client, notebook, kernel gateway, and enterprise gateway along with `resource.getrusage(resource.RUSAGE_SELF).ru_maxrss` to monitor growth.\r\n\r\nHowever, since this leak was found prior to the resolution to the IOLoopKernelManager leak (via PR 361) then I suppose the change may not be required - although, in my opinion, is good practice.  I didn't go and back out this change after breaking the circular references that were preventing the leak in 361.",
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/jupyter/notebook/issues/comments/373468725",
    "html_url": "https://github.com/jupyter/notebook/pull/3424#issuecomment-373468725",
    "issue_url": "https://api.github.com/repos/jupyter/notebook/issues/3424",
    "id": 373468725,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM3MzQ2ODcyNQ==",
    "user": {
      "login": "kevin-bates",
      "id": 22599560,
      "node_id": "MDQ6VXNlcjIyNTk5NTYw",
      "avatar_url": "https://avatars.githubusercontent.com/u/22599560?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/kevin-bates",
      "html_url": "https://github.com/kevin-bates",
      "followers_url": "https://api.github.com/users/kevin-bates/followers",
      "following_url": "https://api.github.com/users/kevin-bates/following{/other_user}",
      "gists_url": "https://api.github.com/users/kevin-bates/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/kevin-bates/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/kevin-bates/subscriptions",
      "organizations_url": "https://api.github.com/users/kevin-bates/orgs",
      "repos_url": "https://api.github.com/users/kevin-bates/repos",
      "events_url": "https://api.github.com/users/kevin-bates/events{/privacy}",
      "received_events_url": "https://api.github.com/users/kevin-bates/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-03-15T17:58:49Z",
    "updated_at": "2018-03-15T17:58:49Z",
    "author_association": "MEMBER",
    "body": "Hmm - I just commented out this change (and running with all other fixes in place) and see the iopub object **and** the kernel manager instance leaks return.  I don't see an obvious circular reference introduced by `_activity_stream`, but given the km instance returns indicates this change is required.",
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/jupyter/notebook/issues/comments/377941740",
    "html_url": "https://github.com/jupyter/notebook/pull/3424#issuecomment-377941740",
    "issue_url": "https://api.github.com/repos/jupyter/notebook/issues/3424",
    "id": 377941740,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM3Nzk0MTc0MA==",
    "user": {
      "login": "kevin-bates",
      "id": 22599560,
      "node_id": "MDQ6VXNlcjIyNTk5NTYw",
      "avatar_url": "https://avatars.githubusercontent.com/u/22599560?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/kevin-bates",
      "html_url": "https://github.com/kevin-bates",
      "followers_url": "https://api.github.com/users/kevin-bates/followers",
      "following_url": "https://api.github.com/users/kevin-bates/following{/other_user}",
      "gists_url": "https://api.github.com/users/kevin-bates/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/kevin-bates/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/kevin-bates/subscriptions",
      "organizations_url": "https://api.github.com/users/kevin-bates/orgs",
      "repos_url": "https://api.github.com/users/kevin-bates/repos",
      "events_url": "https://api.github.com/users/kevin-bates/events{/privacy}",
      "received_events_url": "https://api.github.com/users/kevin-bates/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-04-02T14:30:26Z",
    "updated_at": "2018-04-02T14:30:26Z",
    "author_association": "MEMBER",
    "body": "@takluyver - is there anything else you need for this? ",
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/jupyter/notebook/issues/comments/378183475",
    "html_url": "https://github.com/jupyter/notebook/pull/3424#issuecomment-378183475",
    "issue_url": "https://api.github.com/repos/jupyter/notebook/issues/3424",
    "id": 378183475,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM3ODE4MzQ3NQ==",
    "user": {
      "login": "takluyver",
      "id": 327925,
      "node_id": "MDQ6VXNlcjMyNzkyNQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/327925?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/takluyver",
      "html_url": "https://github.com/takluyver",
      "followers_url": "https://api.github.com/users/takluyver/followers",
      "following_url": "https://api.github.com/users/takluyver/following{/other_user}",
      "gists_url": "https://api.github.com/users/takluyver/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/takluyver/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/takluyver/subscriptions",
      "organizations_url": "https://api.github.com/users/takluyver/orgs",
      "repos_url": "https://api.github.com/users/takluyver/repos",
      "events_url": "https://api.github.com/users/takluyver/events{/privacy}",
      "received_events_url": "https://api.github.com/users/takluyver/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-04-03T09:14:03Z",
    "updated_at": "2018-04-03T09:14:03Z",
    "author_association": "MEMBER",
    "body": "No, I don't think so. I'll close and reopen it to rerun the tests.",
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/jupyter/notebook/issues/comments/378274957",
    "html_url": "https://github.com/jupyter/notebook/pull/3424#issuecomment-378274957",
    "issue_url": "https://api.github.com/repos/jupyter/notebook/issues/3424",
    "id": 378274957,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM3ODI3NDk1Nw==",
    "user": {
      "login": "kevin-bates",
      "id": 22599560,
      "node_id": "MDQ6VXNlcjIyNTk5NTYw",
      "avatar_url": "https://avatars.githubusercontent.com/u/22599560?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/kevin-bates",
      "html_url": "https://github.com/kevin-bates",
      "followers_url": "https://api.github.com/users/kevin-bates/followers",
      "following_url": "https://api.github.com/users/kevin-bates/following{/other_user}",
      "gists_url": "https://api.github.com/users/kevin-bates/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/kevin-bates/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/kevin-bates/subscriptions",
      "organizations_url": "https://api.github.com/users/kevin-bates/orgs",
      "repos_url": "https://api.github.com/users/kevin-bates/repos",
      "events_url": "https://api.github.com/users/kevin-bates/events{/privacy}",
      "received_events_url": "https://api.github.com/users/kevin-bates/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-04-03T14:42:58Z",
    "updated_at": "2018-04-03T14:42:58Z",
    "author_association": "MEMBER",
    "body": "Thank you Thomas!",
    "performed_via_github_app": null
  }
]
