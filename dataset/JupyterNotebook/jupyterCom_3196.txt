[
  {
    "url": "https://api.github.com/repos/jupyter/notebook/issues/comments/356759738",
    "html_url": "https://github.com/jupyter/notebook/issues/3196#issuecomment-356759738",
    "issue_url": "https://api.github.com/repos/jupyter/notebook/issues/3196",
    "id": 356759738,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM1Njc1OTczOA==",
    "user": {
      "login": "leontp587",
      "id": 8048271,
      "node_id": "MDQ6VXNlcjgwNDgyNzE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8048271?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/leontp587",
      "html_url": "https://github.com/leontp587",
      "followers_url": "https://api.github.com/users/leontp587/followers",
      "following_url": "https://api.github.com/users/leontp587/following{/other_user}",
      "gists_url": "https://api.github.com/users/leontp587/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/leontp587/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/leontp587/subscriptions",
      "organizations_url": "https://api.github.com/users/leontp587/orgs",
      "repos_url": "https://api.github.com/users/leontp587/repos",
      "events_url": "https://api.github.com/users/leontp587/events{/privacy}",
      "received_events_url": "https://api.github.com/users/leontp587/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-01-10T22:32:22Z",
    "updated_at": "2018-01-12T16:24:50Z",
    "author_association": "NONE",
    "body": "After looking at the code: the problem is in notebook/base/handlers.py\r\n\r\n```python\r\ndef clear_login_cookie(self):\r\n        cookie_options = self.settings.get('cookie_options', {})\r\n        path = cookie_options.setdefault('path', self.base_url)\r\n        self.clear_cookie(self.cookie_name, path=path) # first clear_cookie\r\n        if path and path != '/':\r\n            # also clear cookie on / to ensure old cookies\r\n            # are cleared after the change in path behavior.\r\n            self.clear_cookie(self.cookie_name) # second clear_cookie\r\n```\r\n\r\nThe problem is in the last line where I've marked `# second clear_cookie`. Commenting this out fixes the problem.\r\n\r\nThe issue is that clear_cookie is implemented by the Tornado backend on the server side by marking the cookie as expired. Cookies don’t actually expire on the server though, they are implemented by the client browser on the http response. Cookies have paths, the first call to clear_cookie on the line where I marked // first clear_cookie has a path set correctly, and the Tornado backend sets the cookie for expiration. The second call to clear_cookie inside the if block has no path set, so the Tornado backend gets confused and messes up the cookie expiration from the first call. So when the browser gets the response, it doesn’t clear the cookie.\r\n\r\nThe reason this doesn’t happen if Jupyter doesn’t have a base_url is because in that case path=’’, so the two clear_cookie calls are equivalent.\r\n\r\nThe easiest fix it to comment out the second call to clear_cookie, if we don't care about accounting for the behavior of cookies from old Jupyter versions. I'm not sure what a full fix is yet.\r\n\r\nThis is in some ways really a Tornado bug with dealing with cookies with paths rather than a Jupyter bug.",
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/jupyter/notebook/issues/comments/357296051",
    "html_url": "https://github.com/jupyter/notebook/issues/3196#issuecomment-357296051",
    "issue_url": "https://api.github.com/repos/jupyter/notebook/issues/3196",
    "id": 357296051,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM1NzI5NjA1MQ==",
    "user": {
      "login": "takluyver",
      "id": 327925,
      "node_id": "MDQ6VXNlcjMyNzkyNQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/327925?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/takluyver",
      "html_url": "https://github.com/takluyver",
      "followers_url": "https://api.github.com/users/takluyver/followers",
      "following_url": "https://api.github.com/users/takluyver/following{/other_user}",
      "gists_url": "https://api.github.com/users/takluyver/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/takluyver/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/takluyver/subscriptions",
      "organizations_url": "https://api.github.com/users/takluyver/orgs",
      "repos_url": "https://api.github.com/users/takluyver/repos",
      "events_url": "https://api.github.com/users/takluyver/events{/privacy}",
      "received_events_url": "https://api.github.com/users/takluyver/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-01-12T17:04:18Z",
    "updated_at": "2018-01-12T17:04:18Z",
    "author_association": "MEMBER",
    "body": "Thanks for taking the time to investigate this!\r\n\r\nThe code was only added quite recently (#2959), so it's not ideal to get rid of the path for dealing with 'old' cookies just yet. I think I can see how we might work around the limitation.",
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/jupyter/notebook/issues/comments/357310669",
    "html_url": "https://github.com/jupyter/notebook/issues/3196#issuecomment-357310669",
    "issue_url": "https://api.github.com/repos/jupyter/notebook/issues/3196",
    "id": 357310669,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM1NzMxMDY2OQ==",
    "user": {
      "login": "takluyver",
      "id": 327925,
      "node_id": "MDQ6VXNlcjMyNzkyNQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/327925?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/takluyver",
      "html_url": "https://github.com/takluyver",
      "followers_url": "https://api.github.com/users/takluyver/followers",
      "following_url": "https://api.github.com/users/takluyver/following{/other_user}",
      "gists_url": "https://api.github.com/users/takluyver/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/takluyver/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/takluyver/subscriptions",
      "organizations_url": "https://api.github.com/users/takluyver/orgs",
      "repos_url": "https://api.github.com/users/takluyver/repos",
      "events_url": "https://api.github.com/users/takluyver/events{/privacy}",
      "received_events_url": "https://api.github.com/users/takluyver/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-01-12T18:01:19Z",
    "updated_at": "2018-01-12T18:01:19Z",
    "author_association": "MEMBER",
    "body": "#3207 fixes it for me, but it's a bit of a hackish workaround.",
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/jupyter/notebook/issues/comments/360180245",
    "html_url": "https://github.com/jupyter/notebook/issues/3196#issuecomment-360180245",
    "issue_url": "https://api.github.com/repos/jupyter/notebook/issues/3196",
    "id": 360180245,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM2MDE4MDI0NQ==",
    "user": {
      "login": "leontp587",
      "id": 8048271,
      "node_id": "MDQ6VXNlcjgwNDgyNzE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8048271?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/leontp587",
      "html_url": "https://github.com/leontp587",
      "followers_url": "https://api.github.com/users/leontp587/followers",
      "following_url": "https://api.github.com/users/leontp587/following{/other_user}",
      "gists_url": "https://api.github.com/users/leontp587/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/leontp587/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/leontp587/subscriptions",
      "organizations_url": "https://api.github.com/users/leontp587/orgs",
      "repos_url": "https://api.github.com/users/leontp587/repos",
      "events_url": "https://api.github.com/users/leontp587/events{/privacy}",
      "received_events_url": "https://api.github.com/users/leontp587/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-01-24T15:56:27Z",
    "updated_at": "2018-01-24T15:56:27Z",
    "author_association": "NONE",
    "body": "thanks for getting it fixed so quickly!",
    "performed_via_github_app": null
  }
]
