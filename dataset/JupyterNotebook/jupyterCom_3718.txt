[
  {
    "url": "https://api.github.com/repos/jupyter/notebook/issues/comments/400764226",
    "html_url": "https://github.com/jupyter/notebook/issues/3718#issuecomment-400764226",
    "issue_url": "https://api.github.com/repos/jupyter/notebook/issues/3718",
    "id": 400764226,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQwMDc2NDIyNg==",
    "user": {
      "login": "takluyver",
      "id": 327925,
      "node_id": "MDQ6VXNlcjMyNzkyNQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/327925?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/takluyver",
      "html_url": "https://github.com/takluyver",
      "followers_url": "https://api.github.com/users/takluyver/followers",
      "following_url": "https://api.github.com/users/takluyver/following{/other_user}",
      "gists_url": "https://api.github.com/users/takluyver/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/takluyver/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/takluyver/subscriptions",
      "organizations_url": "https://api.github.com/users/takluyver/orgs",
      "repos_url": "https://api.github.com/users/takluyver/repos",
      "events_url": "https://api.github.com/users/takluyver/events{/privacy}",
      "received_events_url": "https://api.github.com/users/takluyver/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-06-27T17:23:33Z",
    "updated_at": "2018-06-27T17:23:33Z",
    "author_association": "MEMBER",
    "body": "Are you running the notebook server on SSH and then disconnecting?\r\n\r\nThere are two things that can happen to cause this:\r\n\r\n- The contents of `/run/user/1000` (aka XDG_RUNTIME_DIR) can be deleted after 6 hours if they don't have the 'sticky bit' set. We [try to set the sticky bit](https://github.com/jupyter/jupyter_client/blob/44980c13680f4e4226cf25f199ce4e4bb6e11296/jupyter_client/connect.py#L140-L164), but maybe that's going wrong somewhere.\r\n- `/run/user/1000` itself has to be deleted when you log out. The definition of 'log out' is not really clear, but in at least some circumstances, starting jupyter in screen or nohup and then disconnecting seems to cause it to disappear.",
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/jupyter/notebook/issues/comments/401058501",
    "html_url": "https://github.com/jupyter/notebook/issues/3718#issuecomment-401058501",
    "issue_url": "https://api.github.com/repos/jupyter/notebook/issues/3718",
    "id": 401058501,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQwMTA1ODUwMQ==",
    "user": {
      "login": "sebma",
      "id": 4569306,
      "node_id": "MDQ6VXNlcjQ1NjkzMDY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4569306?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sebma",
      "html_url": "https://github.com/sebma",
      "followers_url": "https://api.github.com/users/sebma/followers",
      "following_url": "https://api.github.com/users/sebma/following{/other_user}",
      "gists_url": "https://api.github.com/users/sebma/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sebma/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sebma/subscriptions",
      "organizations_url": "https://api.github.com/users/sebma/orgs",
      "repos_url": "https://api.github.com/users/sebma/repos",
      "events_url": "https://api.github.com/users/sebma/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sebma/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-06-28T14:40:44Z",
    "updated_at": "2018-06-28T14:40:44Z",
    "author_association": "NONE",
    "body": "@takluyver You're right, I start the notebook with a nohup through ssh.\r\n\r\nBut the directory does not get deleted every time I log out.\r\n\r\nI guess I have to try and set the sticky bit then : \r\n\r\n```python\r\njupyterRunTimeDIR = os.environ.get('XDG_RUNTIME_DIR') + '/jupyter'\r\nos.chmod(jupyterRunTimeDIR, os.stat(jupyterRunTimeDIR).st_mode | stat.S_ISVTX )\r\n```",
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/jupyter/notebook/issues/comments/401069497",
    "html_url": "https://github.com/jupyter/notebook/issues/3718#issuecomment-401069497",
    "issue_url": "https://api.github.com/repos/jupyter/notebook/issues/3718",
    "id": 401069497,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQwMTA2OTQ5Nw==",
    "user": {
      "login": "takluyver",
      "id": 327925,
      "node_id": "MDQ6VXNlcjMyNzkyNQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/327925?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/takluyver",
      "html_url": "https://github.com/takluyver",
      "followers_url": "https://api.github.com/users/takluyver/followers",
      "following_url": "https://api.github.com/users/takluyver/following{/other_user}",
      "gists_url": "https://api.github.com/users/takluyver/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/takluyver/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/takluyver/subscriptions",
      "organizations_url": "https://api.github.com/users/takluyver/orgs",
      "repos_url": "https://api.github.com/users/takluyver/repos",
      "events_url": "https://api.github.com/users/takluyver/events{/privacy}",
      "received_events_url": "https://api.github.com/users/takluyver/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-06-28T15:12:31Z",
    "updated_at": "2018-06-28T15:12:31Z",
    "author_association": "MEMBER",
    "body": "> But the directory does not get deleted every time I log out.\r\n\r\nHow are you checking? If you log back in to check, it will be recreated.\r\n\r\n> I guess I have to try and set the sticky bit then :\r\n\r\nWe should already be doing that, but maybe something is going wrong. Given that you're using nohup, I would guess it's the other thing.\r\n",
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/jupyter/notebook/issues/comments/401081332",
    "html_url": "https://github.com/jupyter/notebook/issues/3718#issuecomment-401081332",
    "issue_url": "https://api.github.com/repos/jupyter/notebook/issues/3718",
    "id": 401081332,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQwMTA4MTMzMg==",
    "user": {
      "login": "sebma",
      "id": 4569306,
      "node_id": "MDQ6VXNlcjQ1NjkzMDY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4569306?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sebma",
      "html_url": "https://github.com/sebma",
      "followers_url": "https://api.github.com/users/sebma/followers",
      "following_url": "https://api.github.com/users/sebma/following{/other_user}",
      "gists_url": "https://api.github.com/users/sebma/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sebma/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sebma/subscriptions",
      "organizations_url": "https://api.github.com/users/sebma/orgs",
      "repos_url": "https://api.github.com/users/sebma/repos",
      "events_url": "https://api.github.com/users/sebma/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sebma/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-06-28T15:47:19Z",
    "updated_at": "2018-06-28T15:53:09Z",
    "author_association": "NONE",
    "body": "@takluyver To check if it is deleted upon bash logout, I added an `mkdir -pv $(jupyter --runtime-dir)` in my bash init scripts.\r\n\r\nSo when I log back on I can see if the directory is recreated or not, hence if it was previously deleted or not.\r\n\r\nFor the second point, your code at [Line 140](https://github.com/jupyter/jupyter_client/blob/44980c13680f4e4226cf25f199ce4e4bb6e11296/jupyter_client/connect.py#L140) does nothing if `hasattr` returns an incorrect result.\r\n\r\nI read [here](https://hynek.me/articles/hasattr/) that you should use `getattr` instead of `hasattr`, like this : \r\n\r\n`getattr(stat, \"S_ISVTX\", None)`",
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/jupyter/notebook/issues/comments/401134633",
    "html_url": "https://github.com/jupyter/notebook/issues/3718#issuecomment-401134633",
    "issue_url": "https://api.github.com/repos/jupyter/notebook/issues/3718",
    "id": 401134633,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQwMTEzNDYzMw==",
    "user": {
      "login": "takluyver",
      "id": 327925,
      "node_id": "MDQ6VXNlcjMyNzkyNQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/327925?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/takluyver",
      "html_url": "https://github.com/takluyver",
      "followers_url": "https://api.github.com/users/takluyver/followers",
      "following_url": "https://api.github.com/users/takluyver/following{/other_user}",
      "gists_url": "https://api.github.com/users/takluyver/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/takluyver/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/takluyver/subscriptions",
      "organizations_url": "https://api.github.com/users/takluyver/orgs",
      "repos_url": "https://api.github.com/users/takluyver/repos",
      "events_url": "https://api.github.com/users/takluyver/events{/privacy}",
      "received_events_url": "https://api.github.com/users/takluyver/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-06-28T18:44:36Z",
    "updated_at": "2018-06-28T18:44:36Z",
    "author_association": "MEMBER",
    "body": "I don't think the `hasattr()` problems apply here - `stat` is a module, and getting an attribute from it shouldn't raise anything besides AttributeError. I think this is a red herring.\r\n\r\nWhat do you see from your `mkdir` command? I don't think this can distinguish between `/run/user/1000/jupyter` being deleted and `/run/user/1000` being deleted and then recreated on login.",
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/jupyter/notebook/issues/comments/401180399",
    "html_url": "https://github.com/jupyter/notebook/issues/3718#issuecomment-401180399",
    "issue_url": "https://api.github.com/repos/jupyter/notebook/issues/3718",
    "id": 401180399,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQwMTE4MDM5OQ==",
    "user": {
      "login": "sebma",
      "id": 4569306,
      "node_id": "MDQ6VXNlcjQ1NjkzMDY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4569306?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sebma",
      "html_url": "https://github.com/sebma",
      "followers_url": "https://api.github.com/users/sebma/followers",
      "following_url": "https://api.github.com/users/sebma/following{/other_user}",
      "gists_url": "https://api.github.com/users/sebma/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sebma/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sebma/subscriptions",
      "organizations_url": "https://api.github.com/users/sebma/orgs",
      "repos_url": "https://api.github.com/users/sebma/repos",
      "events_url": "https://api.github.com/users/sebma/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sebma/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-06-28T21:33:56Z",
    "updated_at": "2018-06-29T09:30:17Z",
    "author_association": "NONE",
    "body": "@takluyver OK.\r\n\r\nRegarding `mkdir` : \r\n\r\n```bash\r\n$ mkdir --help | grep \"verbose\"\r\n  -v, --verbose     print a message for each created directory\r\n```\r\n\r\nI don't wait a minute before login back\r\n\r\nIf the bash logout didn't delete `/run/user/1000/jupyter` then the `mkdir` executed at next login won't show anything.\r\nIf the bash logout DID delete `/run/user/1000/jupyter` then the `mkdir` executed at next login will show this : \r\n```bash\r\nmkdir: created directory ‘/run/user/1000/jupyter’\r\n```\r\n",
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/jupyter/notebook/issues/comments/401554880",
    "html_url": "https://github.com/jupyter/notebook/issues/3718#issuecomment-401554880",
    "issue_url": "https://api.github.com/repos/jupyter/notebook/issues/3718",
    "id": 401554880,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQwMTU1NDg4MA==",
    "user": {
      "login": "takluyver",
      "id": 327925,
      "node_id": "MDQ6VXNlcjMyNzkyNQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/327925?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/takluyver",
      "html_url": "https://github.com/takluyver",
      "followers_url": "https://api.github.com/users/takluyver/followers",
      "following_url": "https://api.github.com/users/takluyver/following{/other_user}",
      "gists_url": "https://api.github.com/users/takluyver/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/takluyver/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/takluyver/subscriptions",
      "organizations_url": "https://api.github.com/users/takluyver/orgs",
      "repos_url": "https://api.github.com/users/takluyver/repos",
      "events_url": "https://api.github.com/users/takluyver/events{/privacy}",
      "received_events_url": "https://api.github.com/users/takluyver/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-06-30T17:25:05Z",
    "updated_at": "2018-06-30T17:25:05Z",
    "author_association": "MEMBER",
    "body": "We know `/run/user/1000/jupyter` gets deleted - that's what causes the error you're seeing. The question is whether it deletes the directory above as well - `/run/user/1000`. And I don't think your mechanism can tell that, because when you next login, `/run/user/1000` would be automatically recreated before your `mkdir` command runs.\r\n\r\nTo check, I think you would need a script that checks for the existence of `/run/user/1000` once per second. Run that in nohup, then disconnect, wait a while, log back in and see what has come from the running script.",
    "performed_via_github_app": null
  }
]
