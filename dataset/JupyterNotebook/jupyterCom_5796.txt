[
  {
    "url": "https://api.github.com/repos/jupyter/notebook/issues/comments/703926102",
    "html_url": "https://github.com/jupyter/notebook/issues/5796#issuecomment-703926102",
    "issue_url": "https://api.github.com/repos/jupyter/notebook/issues/5796",
    "id": 703926102,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcwMzkyNjEwMg==",
    "user": {
      "login": "kevin-bates",
      "id": 22599560,
      "node_id": "MDQ6VXNlcjIyNTk5NTYw",
      "avatar_url": "https://avatars.githubusercontent.com/u/22599560?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/kevin-bates",
      "html_url": "https://github.com/kevin-bates",
      "followers_url": "https://api.github.com/users/kevin-bates/followers",
      "following_url": "https://api.github.com/users/kevin-bates/following{/other_user}",
      "gists_url": "https://api.github.com/users/kevin-bates/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/kevin-bates/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/kevin-bates/subscriptions",
      "organizations_url": "https://api.github.com/users/kevin-bates/orgs",
      "repos_url": "https://api.github.com/users/kevin-bates/repos",
      "events_url": "https://api.github.com/users/kevin-bates/events{/privacy}",
      "received_events_url": "https://api.github.com/users/kevin-bates/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-10-05T22:36:56Z",
    "updated_at": "2020-10-05T22:36:56Z",
    "author_association": "MEMBER",
    "body": "Hmm, given you can even create terminals means that you have the `terminado` package available.  This package is silently ignored if it can't be imported, but that's not the issue.\r\n\r\nI suspect that this could boil down to the installed notebook version (since this functionality is relatively new `>=6.1.0`), but, again, I doubt you're running a version of notebook older than what's in the base image.\r\n\r\nThis would leave configuration and perhaps your build isn't picking up the culling config settings.  Do you also have kernel culling enabled and is it appearing 'active' in the logs relative to the updated image?  How are you enabling these config values - CLI or config file?  File configuration values are usually prefixed with `c.` (e.g., `c.TerminalManager.cull_interval=600`) while CLI values are prefixed with `--` (e.g., `--TerminalManager.cull_interval=600`).  Perhaps that's the issue?\r\n\r\nSince this is a Hub installation, is the config meant to propagate during the spawn of the notebook server?  But, again, that should be identical across the two images you're using, although its probably something worth checking.",
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/jupyter/notebook/issues/comments/704031179",
    "html_url": "https://github.com/jupyter/notebook/issues/5796#issuecomment-704031179",
    "issue_url": "https://api.github.com/repos/jupyter/notebook/issues/5796",
    "id": 704031179,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcwNDAzMTE3OQ==",
    "user": {
      "login": "dipen-epi",
      "id": 69249664,
      "node_id": "MDQ6VXNlcjY5MjQ5NjY0",
      "avatar_url": "https://avatars.githubusercontent.com/u/69249664?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dipen-epi",
      "html_url": "https://github.com/dipen-epi",
      "followers_url": "https://api.github.com/users/dipen-epi/followers",
      "following_url": "https://api.github.com/users/dipen-epi/following{/other_user}",
      "gists_url": "https://api.github.com/users/dipen-epi/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dipen-epi/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dipen-epi/subscriptions",
      "organizations_url": "https://api.github.com/users/dipen-epi/orgs",
      "repos_url": "https://api.github.com/users/dipen-epi/repos",
      "events_url": "https://api.github.com/users/dipen-epi/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dipen-epi/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-10-06T05:11:41Z",
    "updated_at": "2020-10-06T05:11:41Z",
    "author_association": "NONE",
    "body": "Yes, I checked for the `terminado` package and it is available. The notebook version is also the same as the base image I'm using.\r\n\r\nI have the kernel culling available as well, which works well in my updated image. I'm passing the settings to kubespawner as arguments with a `--` prefix as \r\n\r\n```\r\n'--MappingKernelManager.cull_idle_timeout=3600', '--TerminalManager.cull_inactive_timeout=3600'\r\n```\r\n\r\nI believe that the Hub propagates the settings to the notebook config during spawning, and I can see the notebook server with the propagated args as\r\n\r\n```\r\njupyterhub-singleuser\r\n      --allow-root\r\n      --NotebookApp.shutdown_no_activity_timeout=3900\r\n      --MappingKernelManager.cull_idle_timeout=3600\r\n      --MappingKernelManager.cull_interval=600\r\n      --TerminalManager.cull_inactive_timeout=3600\r\n      --TerminalManager.cull_interval=600\r\n      --ip=0.0.0.0\r\n      --port=8888\r\n      --NotebookApp.default_url=/lab\r\n      --debug\r\n```\r\n\r\nHowever, when I check the logs I am unable to see any TerminalManager culling checks while the MappingKernelManager checks for idle kernels periodically.",
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/jupyter/notebook/issues/comments/704283669",
    "html_url": "https://github.com/jupyter/notebook/issues/5796#issuecomment-704283669",
    "issue_url": "https://api.github.com/repos/jupyter/notebook/issues/5796",
    "id": 704283669,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcwNDI4MzY2OQ==",
    "user": {
      "login": "kevin-bates",
      "id": 22599560,
      "node_id": "MDQ6VXNlcjIyNTk5NTYw",
      "avatar_url": "https://avatars.githubusercontent.com/u/22599560?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/kevin-bates",
      "html_url": "https://github.com/kevin-bates",
      "followers_url": "https://api.github.com/users/kevin-bates/followers",
      "following_url": "https://api.github.com/users/kevin-bates/following{/other_user}",
      "gists_url": "https://api.github.com/users/kevin-bates/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/kevin-bates/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/kevin-bates/subscriptions",
      "organizations_url": "https://api.github.com/users/kevin-bates/orgs",
      "repos_url": "https://api.github.com/users/kevin-bates/repos",
      "events_url": "https://api.github.com/users/kevin-bates/events{/privacy}",
      "received_events_url": "https://api.github.com/users/kevin-bates/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-10-06T13:51:57Z",
    "updated_at": "2020-10-06T13:51:57Z",
    "author_association": "MEMBER",
    "body": "Hmm - sounds like you've made all the right checks.  I would closely examine the delta between the base image that works and your mods - which I'm sure you've already done.  I'm not familiar with the hub spawner interactions but given other options appear to \"flow\" and the transitive property holds in computing, there must be something in the installation/deployment of the changes.\r\n\r\nAre you at all reinstalling the notebook version or making changes to the base image notebook installation?\r\n\r\nAre you able to run your image outside of Hub and see the same results?\r\n\r\nIf you want to send me your Dockerfile that applies the changes to the base image, I can be another pair of eyes.  Feel free to email me using my GH profile's email.",
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/jupyter/notebook/issues/comments/705569901",
    "html_url": "https://github.com/jupyter/notebook/issues/5796#issuecomment-705569901",
    "issue_url": "https://api.github.com/repos/jupyter/notebook/issues/5796",
    "id": 705569901,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcwNTU2OTkwMQ==",
    "user": {
      "login": "dipen-epi",
      "id": 69249664,
      "node_id": "MDQ6VXNlcjY5MjQ5NjY0",
      "avatar_url": "https://avatars.githubusercontent.com/u/69249664?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dipen-epi",
      "html_url": "https://github.com/dipen-epi",
      "followers_url": "https://api.github.com/users/dipen-epi/followers",
      "following_url": "https://api.github.com/users/dipen-epi/following{/other_user}",
      "gists_url": "https://api.github.com/users/dipen-epi/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dipen-epi/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dipen-epi/subscriptions",
      "organizations_url": "https://api.github.com/users/dipen-epi/orgs",
      "repos_url": "https://api.github.com/users/dipen-epi/repos",
      "events_url": "https://api.github.com/users/dipen-epi/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dipen-epi/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-10-08T13:30:56Z",
    "updated_at": "2020-10-08T13:30:56Z",
    "author_association": "NONE",
    "body": "Update: I was able to resolve this, turns out the modified image was being built on a notebook image which predates the addition of TerminalManager culling functionality, while the testing image was a recent one. Updated the base image for the team, and now the terminals are getting culled as expected\r\n@kevin-bates closing this with a note of thanks for the prompt replies! :bowing_man: ",
    "performed_via_github_app": null
  }
]
