[
  {
    "url": "https://api.github.com/repos/jupyter/notebook/issues/comments/615892340",
    "html_url": "https://github.com/jupyter/notebook/issues/5386#issuecomment-615892340",
    "issue_url": "https://api.github.com/repos/jupyter/notebook/issues/5386",
    "id": 615892340,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYxNTg5MjM0MA==",
    "user": {
      "login": "kevin-bates",
      "id": 22599560,
      "node_id": "MDQ6VXNlcjIyNTk5NTYw",
      "avatar_url": "https://avatars.githubusercontent.com/u/22599560?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/kevin-bates",
      "html_url": "https://github.com/kevin-bates",
      "followers_url": "https://api.github.com/users/kevin-bates/followers",
      "following_url": "https://api.github.com/users/kevin-bates/following{/other_user}",
      "gists_url": "https://api.github.com/users/kevin-bates/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/kevin-bates/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/kevin-bates/subscriptions",
      "organizations_url": "https://api.github.com/users/kevin-bates/orgs",
      "repos_url": "https://api.github.com/users/kevin-bates/repos",
      "events_url": "https://api.github.com/users/kevin-bates/events{/privacy}",
      "received_events_url": "https://api.github.com/users/kevin-bates/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-04-18T15:44:57Z",
    "updated_at": "2020-04-18T15:44:57Z",
    "author_association": "MEMBER",
    "body": "Hi @bensussman - thanks for opening this issue.\r\n\r\nI'm unable to reproduce this locally - are you able to reproduce this outside of docker?\r\n\r\n>It is (usually) correctly shutting down the server after there are no kernels and the no activity timeout has exceeded\r\n\r\nIs this meant to imply the issue (i.e., docker stays running) is intermittent, or that you find the `shutdown-no-activity` functionality is not working at all - sometimes.\r\n\r\nAre you using your own image or one produced via [jupyter/docker-stacks](https://github.com/jupyter/docker-stacks)?",
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/jupyter/notebook/issues/comments/615950138",
    "html_url": "https://github.com/jupyter/notebook/issues/5386#issuecomment-615950138",
    "issue_url": "https://api.github.com/repos/jupyter/notebook/issues/5386",
    "id": 615950138,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYxNTk1MDEzOA==",
    "user": {
      "login": "bensussman",
      "id": 86856,
      "node_id": "MDQ6VXNlcjg2ODU2",
      "avatar_url": "https://avatars.githubusercontent.com/u/86856?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bensussman",
      "html_url": "https://github.com/bensussman",
      "followers_url": "https://api.github.com/users/bensussman/followers",
      "following_url": "https://api.github.com/users/bensussman/following{/other_user}",
      "gists_url": "https://api.github.com/users/bensussman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bensussman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bensussman/subscriptions",
      "organizations_url": "https://api.github.com/users/bensussman/orgs",
      "repos_url": "https://api.github.com/users/bensussman/repos",
      "events_url": "https://api.github.com/users/bensussman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bensussman/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-04-18T21:10:16Z",
    "updated_at": "2020-04-18T21:14:21Z",
    "author_association": "NONE",
    "body": "Hey @kevin-bates thanks for the reply! We are actually using a custom image (because we are providing a lot of other dependencies to our Jupyter users). You can see the image here: https://hub.docker.com/r/spellrun/default-cpu. I have not tried to reproduce it out of docker, but I will definitely give it a shot on Monday.\r\n\r\nGood question re: intermittent. I am able to deterministically reproduce it in my current docker environment with a container running the `default-cpu` image. However when I spin up new environments (new EC2 instance, new container instance) I **do** see different behavior (including both not shutting down due to no-activity at all, and shutting down correctly and exiting the process) at first. One theory could be that some file-system-state within the docker container is causing the failure for Jupyter to cleanly shut down, and that's why brand new environments see different behavior? It's important to note that it's not a rare failure for us.",
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/jupyter/notebook/issues/comments/616195803",
    "html_url": "https://github.com/jupyter/notebook/issues/5386#issuecomment-616195803",
    "issue_url": "https://api.github.com/repos/jupyter/notebook/issues/5386",
    "id": 616195803,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYxNjE5NTgwMw==",
    "user": {
      "login": "kevin-bates",
      "id": 22599560,
      "node_id": "MDQ6VXNlcjIyNTk5NTYw",
      "avatar_url": "https://avatars.githubusercontent.com/u/22599560?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/kevin-bates",
      "html_url": "https://github.com/kevin-bates",
      "followers_url": "https://api.github.com/users/kevin-bates/followers",
      "following_url": "https://api.github.com/users/kevin-bates/following{/other_user}",
      "gists_url": "https://api.github.com/users/kevin-bates/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/kevin-bates/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/kevin-bates/subscriptions",
      "organizations_url": "https://api.github.com/users/kevin-bates/orgs",
      "repos_url": "https://api.github.com/users/kevin-bates/repos",
      "events_url": "https://api.github.com/users/kevin-bates/events{/privacy}",
      "received_events_url": "https://api.github.com/users/kevin-bates/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-04-19T17:56:40Z",
    "updated_at": "2020-04-19T17:56:40Z",
    "author_association": "MEMBER",
    "body": "I'm running the following and cannot seem to reproduce the issue in 3 attempts so far...\r\n```bash\r\ndocker run -p 8888:8888 --rm -it  docker.io/spellrun/default-cpu:latest jupyter notebook  --ip 0.0.0.0  --allow-root  --no-browser  --log-level=DEBUG  --NotebookApp.allow_password_change=False  --NotebookApp.quit_button=False  --NotebookApp.shutdown_no_activity_timeout=60  --MappingKernelManager.cull_idle_timeout=60  --MappingKernelManager.cull_interval=10  --MappingKernelManager.cull_connected=True  --MappingKernelManager.cull_busy=False\r\n```\r\nCan you please sure the command you use to reproduce the issue - as well as actions you take once the container is running?  In the 3 attempts, 2 were simply startup and let expire and the 3rd started a kernel, which I let be culled, then the server shutdown in the appropriate poll interval after that.\r\n\r\nThanks.",
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/jupyter/notebook/issues/comments/616865222",
    "html_url": "https://github.com/jupyter/notebook/issues/5386#issuecomment-616865222",
    "issue_url": "https://api.github.com/repos/jupyter/notebook/issues/5386",
    "id": 616865222,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYxNjg2NTIyMg==",
    "user": {
      "login": "bensussman",
      "id": 86856,
      "node_id": "MDQ6VXNlcjg2ODU2",
      "avatar_url": "https://avatars.githubusercontent.com/u/86856?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bensussman",
      "html_url": "https://github.com/bensussman",
      "followers_url": "https://api.github.com/users/bensussman/followers",
      "following_url": "https://api.github.com/users/bensussman/following{/other_user}",
      "gists_url": "https://api.github.com/users/bensussman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bensussman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bensussman/subscriptions",
      "organizations_url": "https://api.github.com/users/bensussman/orgs",
      "repos_url": "https://api.github.com/users/bensussman/repos",
      "events_url": "https://api.github.com/users/bensussman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bensussman/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-04-20T23:34:21Z",
    "updated_at": "2020-04-20T23:34:21Z",
    "author_association": "NONE",
    "body": "Thanks @kevin-bates. I wanted to give you a quick update on what i've been doing: I have been banging away at this all day and am unable to reproduce it using a `docker run` command. This must mean that the docker container context created by our golang api is causing this bug. When I do a docker inspect of the container created by `docker run` vs the container created via our golang api I see quite a few differences (things like `NetworkMode`, `Dns`, `Tmpfs`, etc.) and my only remaining theory is that one of those unique values for the container is causing this issue. I have eliminated disk state as being a cause, as I am able to completely remove any source of disk state and still reproduce the error. I have also eliminated `tornado_settings` and `custom_display_url` as being causes, as I am able to pass them to `docker run` and NOT display the error. I would ask that you ignore this issue for now, and I will reopen it (hopefully very soon) when I have identified the context that triggers this behavior and thus have a better reproducibility story for you. Thanks again for your time!",
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/jupyter/notebook/issues/comments/616884392",
    "html_url": "https://github.com/jupyter/notebook/issues/5386#issuecomment-616884392",
    "issue_url": "https://api.github.com/repos/jupyter/notebook/issues/5386",
    "id": 616884392,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYxNjg4NDM5Mg==",
    "user": {
      "login": "kevin-bates",
      "id": 22599560,
      "node_id": "MDQ6VXNlcjIyNTk5NTYw",
      "avatar_url": "https://avatars.githubusercontent.com/u/22599560?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/kevin-bates",
      "html_url": "https://github.com/kevin-bates",
      "followers_url": "https://api.github.com/users/kevin-bates/followers",
      "following_url": "https://api.github.com/users/kevin-bates/following{/other_user}",
      "gists_url": "https://api.github.com/users/kevin-bates/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/kevin-bates/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/kevin-bates/subscriptions",
      "organizations_url": "https://api.github.com/users/kevin-bates/orgs",
      "repos_url": "https://api.github.com/users/kevin-bates/repos",
      "events_url": "https://api.github.com/users/kevin-bates/events{/privacy}",
      "received_events_url": "https://api.github.com/users/kevin-bates/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-04-21T00:48:11Z",
    "updated_at": "2020-04-21T00:48:11Z",
    "author_association": "MEMBER",
    "body": "Thanks for the great update Ben - this is much appreciated!  Yes, should you find the solution please post back here, even it doesn't warrant the re-opening of this issue.  That way others may be able to learn from your solution.  ",
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/jupyter/notebook/issues/comments/675790222",
    "html_url": "https://github.com/jupyter/notebook/issues/5386#issuecomment-675790222",
    "issue_url": "https://api.github.com/repos/jupyter/notebook/issues/5386",
    "id": 675790222,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY3NTc5MDIyMg==",
    "user": {
      "login": "rschroll",
      "id": 367903,
      "node_id": "MDQ6VXNlcjM2NzkwMw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/367903?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rschroll",
      "html_url": "https://github.com/rschroll",
      "followers_url": "https://api.github.com/users/rschroll/followers",
      "following_url": "https://api.github.com/users/rschroll/following{/other_user}",
      "gists_url": "https://api.github.com/users/rschroll/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rschroll/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rschroll/subscriptions",
      "organizations_url": "https://api.github.com/users/rschroll/orgs",
      "repos_url": "https://api.github.com/users/rschroll/repos",
      "events_url": "https://api.github.com/users/rschroll/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rschroll/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-08-19T00:53:57Z",
    "updated_at": "2020-08-19T00:53:57Z",
    "author_association": "NONE",
    "body": "I think I may be seeing this same issue. The environment is a bit different -- we're running JupyterHub on k8s -- but the behavior is very similar.  Here's what I've noticed:\r\n- If there is no browser window with a notebook open, the server shuts down correctly.  This happens even if there is a running kernel.\r\n- If there is a browser window with a notebook open, the server seems to hang on shutdown.\r\n- It doesn't matter what kernel the notebook is using (at least of the two I tested).\r\n- If you manually shut down the notebook kernel from the \"Running\" tab, but leave the notebook open, it will still hang.  (It doesn't seem to be related to shutting down the kernel.)\r\n- If you manually shut down the notebook kernel from the notebook interface, but leave the notebook open, it will shut down correctly (!).\r\n- Activities that try to contact the singleuser server result in 503 errors, but the JupyterHub interface still shows the server up.  Shutting it down and starting it up restores functionality.\r\n- If I get a shell in the container running the singleuser server after it hangs, I can see that the process is still running.  However, it is not responding on port 8888.  (This is why we're getting 503s, I imagine.)\r\n\r\nAdding in @bensussman's discovery about the websockets, my bet is that something in the server is waiting for a websocket connection to the notebook to be closed, and this is keeping the server process active.  Closing the browser tab, or shutting down the kernel from the notebook, hangs up the websocket correctly, so we don't get the hang.\r\n\r\nWe're using a custom singleuser image.  I can probably try with a standard image, if you think that would be useful.  Just let me know which to try.  Versions of things that might be relevant:\r\n```\r\njupyter                   1.0.0\r\njupyter_client            6.1.0 \r\njupyter_console           6.1.0 \r\njupyter_core              4.6.3\r\njupyterhub                1.1.0\r\nipykernel                 5.1.4\r\nipython                   7.12.0\r\nnotebook                  6.0.3\r\n```\r\n\r\nLet me know if there's any additional debugging that would help.",
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/jupyter/notebook/issues/comments/675837635",
    "html_url": "https://github.com/jupyter/notebook/issues/5386#issuecomment-675837635",
    "issue_url": "https://api.github.com/repos/jupyter/notebook/issues/5386",
    "id": 675837635,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY3NTgzNzYzNQ==",
    "user": {
      "login": "rschroll",
      "id": 367903,
      "node_id": "MDQ6VXNlcjM2NzkwMw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/367903?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rschroll",
      "html_url": "https://github.com/rschroll",
      "followers_url": "https://api.github.com/users/rschroll/followers",
      "following_url": "https://api.github.com/users/rschroll/following{/other_user}",
      "gists_url": "https://api.github.com/users/rschroll/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rschroll/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rschroll/subscriptions",
      "organizations_url": "https://api.github.com/users/rschroll/orgs",
      "repos_url": "https://api.github.com/users/rschroll/repos",
      "events_url": "https://api.github.com/users/rschroll/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rschroll/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-08-19T03:59:02Z",
    "updated_at": "2020-08-19T03:59:02Z",
    "author_association": "NONE",
    "body": "I can reproduce the problem using the jupyterhub/k8s-singleuser-sample image, version 0.9.1.",
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/jupyter/notebook/issues/comments/676793921",
    "html_url": "https://github.com/jupyter/notebook/issues/5386#issuecomment-676793921",
    "issue_url": "https://api.github.com/repos/jupyter/notebook/issues/5386",
    "id": 676793921,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY3Njc5MzkyMQ==",
    "user": {
      "login": "rschroll",
      "id": 367903,
      "node_id": "MDQ6VXNlcjM2NzkwMw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/367903?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rschroll",
      "html_url": "https://github.com/rschroll",
      "followers_url": "https://api.github.com/users/rschroll/followers",
      "following_url": "https://api.github.com/users/rschroll/following{/other_user}",
      "gists_url": "https://api.github.com/users/rschroll/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rschroll/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rschroll/subscriptions",
      "organizations_url": "https://api.github.com/users/rschroll/orgs",
      "repos_url": "https://api.github.com/users/rschroll/repos",
      "events_url": "https://api.github.com/users/rschroll/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rschroll/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-08-19T22:55:43Z",
    "updated_at": "2020-08-19T22:55:43Z",
    "author_association": "NONE",
    "body": "I've managed to reproduce the problem with a docker container running locally.  I launch a Jupyter server with the following command (adapted from above):\r\n```\r\ndocker run -p 8888:8888 --rm -it  docker.io/jupyterhub/k8s-singleuser-sample:0.9.1 jupyter notebook  --ip 0.0.0.0  --allow-root  --no-browser  --log-level=DEBUG  --NotebookApp.allow_password_change=False  --NotebookApp.quit_button=False  --NotebookApp.shutdown_no_activity_timeout=60  --MappingKernelManager.cull_idle_timeout=60  --MappingKernelManager.cull_interval=10  --MappingKernelManager.cull_connected=True  --MappingKernelManager.cull_busy=False\r\n```\r\n\r\nOnce again, I notice it hang when there is a browser tab left open for a notebook.  Specifically, when the server tries to shut down, I see:\r\n- **Success** - Open nothing in the browser\r\n- **Success** - Open only a directory view\r\n- **Hang** - Open a notebook, let the kernel culler stop the kernel\r\n- **Hang** - Open a notebook, kill the kernel from the \"Running\" tab\r\n- **Success** - Open a notebook, shut down the kernel from the notebook\r\n- **Success** - Open a notebook, close the notebook, and then kill the kernel from the \"Running\" tab\r\n- **Success** - Open a notebook, close the notebook, and let the kernel culler stop the kernel\r\n\r\nThis is running a recent docker image, so I suspect it's still a problem.  Can we get this issue reopened?",
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/jupyter/notebook/issues/comments/676828274",
    "html_url": "https://github.com/jupyter/notebook/issues/5386#issuecomment-676828274",
    "issue_url": "https://api.github.com/repos/jupyter/notebook/issues/5386",
    "id": 676828274,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY3NjgyODI3NA==",
    "user": {
      "login": "kevin-bates",
      "id": 22599560,
      "node_id": "MDQ6VXNlcjIyNTk5NTYw",
      "avatar_url": "https://avatars.githubusercontent.com/u/22599560?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/kevin-bates",
      "html_url": "https://github.com/kevin-bates",
      "followers_url": "https://api.github.com/users/kevin-bates/followers",
      "following_url": "https://api.github.com/users/kevin-bates/following{/other_user}",
      "gists_url": "https://api.github.com/users/kevin-bates/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/kevin-bates/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/kevin-bates/subscriptions",
      "organizations_url": "https://api.github.com/users/kevin-bates/orgs",
      "repos_url": "https://api.github.com/users/kevin-bates/repos",
      "events_url": "https://api.github.com/users/kevin-bates/events{/privacy}",
      "received_events_url": "https://api.github.com/users/kevin-bates/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-08-20T00:30:36Z",
    "updated_at": "2020-08-20T00:30:36Z",
    "author_association": "MEMBER",
    "body": "**Thanks for the great troubleshooting @rschroll!** I agree this warrants deeper investigation and likely a fix, but we're probably going to need to eliminate the container aspect to get to the bottom of things.  I'm away for the rest of the week and probably can't look into any time soon anyway, so I'm hoping this will spark someone's interest. \r\n\r\nSounds like it requires a connected kernel that has been culled or shutdown outside of the notebook itself. \r\n\r\nThanks again.\r\n",
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/jupyter/notebook/issues/comments/676953952",
    "html_url": "https://github.com/jupyter/notebook/issues/5386#issuecomment-676953952",
    "issue_url": "https://api.github.com/repos/jupyter/notebook/issues/5386",
    "id": 676953952,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY3Njk1Mzk1Mg==",
    "user": {
      "login": "rschroll",
      "id": 367903,
      "node_id": "MDQ6VXNlcjM2NzkwMw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/367903?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rschroll",
      "html_url": "https://github.com/rschroll",
      "followers_url": "https://api.github.com/users/rschroll/followers",
      "following_url": "https://api.github.com/users/rschroll/following{/other_user}",
      "gists_url": "https://api.github.com/users/rschroll/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rschroll/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rschroll/subscriptions",
      "organizations_url": "https://api.github.com/users/rschroll/orgs",
      "repos_url": "https://api.github.com/users/rschroll/repos",
      "events_url": "https://api.github.com/users/rschroll/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rschroll/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-08-20T03:37:20Z",
    "updated_at": "2020-08-20T03:37:20Z",
    "author_association": "NONE",
    "body": "Thanks for reopening!  I've managed to reproduce the hang locally.  More excitingly, I can also tweak it to not hang. [This environment](https://github.com/jupyter/notebook/files/5100517/env.txt) seems to reliably hang in the conditions discussed above (notebook open, kernel not shut down by notebook).  However, it is sensitive to version numbers.  If I upgrade `notebook` to 6.1.3 (from 6.0.3) OR `jupyter-client` to 6.1.6 (from 6.1.0), I do not get the hang.  That is, it is the interaction of these two versions that cause the hang.\r\n\r\nI also noticed a difference in the debug output in these cases.  When the kernel is culled when the system halts correctly, I see this output:\r\n```\r\n[W 20:08:21.343 NotebookApp] Culling 'idle' kernel 'python3' (dc8f9a3a-68cf-4332-b51b-c723202b1c68) with 1 connections due to 68 seconds of inactivity.\r\n[D 20:08:21.344 NotebookApp] Clearing buffer for dc8f9a3a-68cf-4332-b51b-c723202b1c68\r\n[I 20:08:21.344 NotebookApp] Kernel shutdown: dc8f9a3a-68cf-4332-b51b-c723202b1c68\r\n[D 20:08:21.765 NotebookApp] Websocket closed dc8f9a3a-68cf-4332-b51b-c723202b1c68:4b7b26b5dd7647d88b05acf743b26b0f\r\n[W 20:08:22.774 NotebookApp] 410 DELETE /api/sessions/4c318e03-2833-450f-9d30-6dc639c85c52 (127.0.0.1): Kernel deleted before session\r\n[W 20:08:22.776 NotebookApp] Kernel deleted before session\r\n[W 20:08:22.778 NotebookApp] 410 DELETE /api/sessions/4c318e03-2833-450f-9d30-6dc639c85c52 (127.0.0.1) 8.87ms referer=http://127.0.0.1:8888/notebooks/ipy-scratch/Untitled7.ipynb\r\n```\r\n\r\nHowever, when the system does not halt correctly, I only see the first three lines.  I don't see the websocket closing or the session being deleted.  This would fit with the hypothesis that on open websocket is keeping the server from exiting.\r\n\r\nSo it may be that I just got an unlucky set of versions in the image I was using.  I'll build a new image with updated versions and see if that works on k8s as well.",
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/jupyter/notebook/issues/comments/677711304",
    "html_url": "https://github.com/jupyter/notebook/issues/5386#issuecomment-677711304",
    "issue_url": "https://api.github.com/repos/jupyter/notebook/issues/5386",
    "id": 677711304,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY3NzcxMTMwNA==",
    "user": {
      "login": "kevin-bates",
      "id": 22599560,
      "node_id": "MDQ6VXNlcjIyNTk5NTYw",
      "avatar_url": "https://avatars.githubusercontent.com/u/22599560?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/kevin-bates",
      "html_url": "https://github.com/kevin-bates",
      "followers_url": "https://api.github.com/users/kevin-bates/followers",
      "following_url": "https://api.github.com/users/kevin-bates/following{/other_user}",
      "gists_url": "https://api.github.com/users/kevin-bates/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/kevin-bates/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/kevin-bates/subscriptions",
      "organizations_url": "https://api.github.com/users/kevin-bates/orgs",
      "repos_url": "https://api.github.com/users/kevin-bates/repos",
      "events_url": "https://api.github.com/users/kevin-bates/events{/privacy}",
      "received_events_url": "https://api.github.com/users/kevin-bates/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-08-20T14:47:31Z",
    "updated_at": "2020-08-20T14:47:31Z",
    "author_association": "MEMBER",
    "body": "Excellent information Robert - thank you.  NB 6.1 does include some refactoring of kernel management to add support for async kernel management and jupyter_client 6.1.6 (actually 6.1.5) includes a fix to [properly close the ZMQ context](https://github.com/jupyter/jupyter_client/pull/548) that may be coming into play here.  What I don't really understand is why its NB 6.1.3 OR JC 6.1.6.  However, if both are in play, then simply a new image set might be all that is necessary.\r\n\r\nI'm taking the rest of the week off, so probably won't be able to move anything forward, but it sounds like you're in good shape anyway and we may be able to address this issue by documenting the update or actually bumping the JC dependency.  \r\n\r\nThanks again for the great work!",
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/jupyter/notebook/issues/comments/677992640",
    "html_url": "https://github.com/jupyter/notebook/issues/5386#issuecomment-677992640",
    "issue_url": "https://api.github.com/repos/jupyter/notebook/issues/5386",
    "id": 677992640,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY3Nzk5MjY0MA==",
    "user": {
      "login": "rschroll",
      "id": 367903,
      "node_id": "MDQ6VXNlcjM2NzkwMw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/367903?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rschroll",
      "html_url": "https://github.com/rschroll",
      "followers_url": "https://api.github.com/users/rschroll/followers",
      "following_url": "https://api.github.com/users/rschroll/following{/other_user}",
      "gists_url": "https://api.github.com/users/rschroll/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rschroll/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rschroll/subscriptions",
      "organizations_url": "https://api.github.com/users/rschroll/orgs",
      "repos_url": "https://api.github.com/users/rschroll/repos",
      "events_url": "https://api.github.com/users/rschroll/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rschroll/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-08-21T01:48:48Z",
    "updated_at": "2020-08-21T01:48:48Z",
    "author_association": "NONE",
    "body": "I've built and deployed a new image with the updated versions of both notebook and jupyter-client.  This solves the problem I had noticed on JupyterHub.  I'm happy to help debug further, if it would be useful.  (Although I'll note that I'll be gone next week.)  But I'm also happy to mark this as fixed and close the issue.\r\n\r\n",
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/jupyter/notebook/issues/comments/679432359",
    "html_url": "https://github.com/jupyter/notebook/issues/5386#issuecomment-679432359",
    "issue_url": "https://api.github.com/repos/jupyter/notebook/issues/5386",
    "id": 679432359,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY3OTQzMjM1OQ==",
    "user": {
      "login": "kevin-bates",
      "id": 22599560,
      "node_id": "MDQ6VXNlcjIyNTk5NTYw",
      "avatar_url": "https://avatars.githubusercontent.com/u/22599560?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/kevin-bates",
      "html_url": "https://github.com/kevin-bates",
      "followers_url": "https://api.github.com/users/kevin-bates/followers",
      "following_url": "https://api.github.com/users/kevin-bates/following{/other_user}",
      "gists_url": "https://api.github.com/users/kevin-bates/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/kevin-bates/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/kevin-bates/subscriptions",
      "organizations_url": "https://api.github.com/users/kevin-bates/orgs",
      "repos_url": "https://api.github.com/users/kevin-bates/repos",
      "events_url": "https://api.github.com/users/kevin-bates/events{/privacy}",
      "received_events_url": "https://api.github.com/users/kevin-bates/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-08-25T00:25:40Z",
    "updated_at": "2020-08-25T00:25:40Z",
    "author_association": "MEMBER",
    "body": "I definitely believe there's a tie to the closing of the ZMQ context change in jupyter_client 6.1.5+ since as soon as I install 6.1.5 (running with NB 6.0.3), the hang does not occur.  However, I'm unable to reproduce this using NB 6.1.0 and JC < 6.1.5, but wouldn't be surprised if the async kernel management work has something to do with what you're seeing.\r\n\r\nAt any rate, it looks like the jupyter stacks base notebook image was updated from [6.0.3 to 6.1.3 4 days ago](https://github.com/jupyter/docker-stacks/pull/1151), so I suspect we're good on that front as well and believe the best course of action at this point is to close this.\r\n\r\nThank you @rschroll and @bensussman for all the help in identifying and troubleshooting this!",
    "performed_via_github_app": null
  }
]
