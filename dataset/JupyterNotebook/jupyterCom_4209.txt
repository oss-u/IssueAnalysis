[
  {
    "url": "https://api.github.com/repos/jupyter/notebook/issues/comments/439063661",
    "html_url": "https://github.com/jupyter/notebook/issues/4209#issuecomment-439063661",
    "issue_url": "https://api.github.com/repos/jupyter/notebook/issues/4209",
    "id": 439063661,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQzOTA2MzY2MQ==",
    "user": {
      "login": "glortho",
      "id": 526284,
      "node_id": "MDQ6VXNlcjUyNjI4NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/526284?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/glortho",
      "html_url": "https://github.com/glortho",
      "followers_url": "https://api.github.com/users/glortho/followers",
      "following_url": "https://api.github.com/users/glortho/following{/other_user}",
      "gists_url": "https://api.github.com/users/glortho/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/glortho/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/glortho/subscriptions",
      "organizations_url": "https://api.github.com/users/glortho/orgs",
      "repos_url": "https://api.github.com/users/glortho/repos",
      "events_url": "https://api.github.com/users/glortho/events{/privacy}",
      "received_events_url": "https://api.github.com/users/glortho/received_events",
      "type": "User",
      "site_admin": true
    },
    "created_at": "2018-11-15T14:44:07Z",
    "updated_at": "2018-11-15T19:52:41Z",
    "author_association": "NONE",
    "body": "We've confirmed that this does appear to happen when you land directly on a notebook for the first time after its kernel was culled. Most recently we saw this:\r\n```\r\n[I 21:08:51.983 NotebookApp] Kernel shutdown: 89855d3f-873d-40a5-bbca-4c828e627d73\r\n```\r\nand then when landing on it 6 minutes later:\r\n```\r\n[E 21:14:53.524 NotebookApp] Uncaught exception POST /juno/notebook/api/sessions\r\n```",
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/jupyter/notebook/issues/comments/439075797",
    "html_url": "https://github.com/jupyter/notebook/issues/4209#issuecomment-439075797",
    "issue_url": "https://api.github.com/repos/jupyter/notebook/issues/4209",
    "id": 439075797,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQzOTA3NTc5Nw==",
    "user": {
      "login": "glortho",
      "id": 526284,
      "node_id": "MDQ6VXNlcjUyNjI4NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/526284?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/glortho",
      "html_url": "https://github.com/glortho",
      "followers_url": "https://api.github.com/users/glortho/followers",
      "following_url": "https://api.github.com/users/glortho/following{/other_user}",
      "gists_url": "https://api.github.com/users/glortho/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/glortho/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/glortho/subscriptions",
      "organizations_url": "https://api.github.com/users/glortho/orgs",
      "repos_url": "https://api.github.com/users/glortho/repos",
      "events_url": "https://api.github.com/users/glortho/events{/privacy}",
      "received_events_url": "https://api.github.com/users/glortho/received_events",
      "type": "User",
      "site_admin": true
    },
    "created_at": "2018-11-15T15:17:42Z",
    "updated_at": "2018-11-15T15:18:09Z",
    "author_association": "NONE",
    "body": "I could be off-base but it seems like we'd either want to:\r\n\r\n- delete any sessions with a cullable kernel when the kernel itself is deleted https://github.com/jupyter/notebook/blob/master/notebook/services/kernels/kernelmanager.py#L467\r\n\r\nOr:\r\n\r\n- automatically create a new session rather than raising a `KeyError` here: https://github.com/jupyter/notebook/blob/master/notebook/services/sessions/sessionmanager.py#L209\r\n\r\nThey could be behind config options if need be. Are there ramifications to those that would make them impractical/problematic?",
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/jupyter/notebook/issues/comments/439083415",
    "html_url": "https://github.com/jupyter/notebook/issues/4209#issuecomment-439083415",
    "issue_url": "https://api.github.com/repos/jupyter/notebook/issues/4209",
    "id": 439083415,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQzOTA4MzQxNQ==",
    "user": {
      "login": "kevin-bates",
      "id": 22599560,
      "node_id": "MDQ6VXNlcjIyNTk5NTYw",
      "avatar_url": "https://avatars.githubusercontent.com/u/22599560?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/kevin-bates",
      "html_url": "https://github.com/kevin-bates",
      "followers_url": "https://api.github.com/users/kevin-bates/followers",
      "following_url": "https://api.github.com/users/kevin-bates/following{/other_user}",
      "gists_url": "https://api.github.com/users/kevin-bates/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/kevin-bates/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/kevin-bates/subscriptions",
      "organizations_url": "https://api.github.com/users/kevin-bates/orgs",
      "repos_url": "https://api.github.com/users/kevin-bates/repos",
      "events_url": "https://api.github.com/users/kevin-bates/events{/privacy}",
      "received_events_url": "https://api.github.com/users/kevin-bates/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-11-15T15:38:44Z",
    "updated_at": "2018-11-15T15:38:44Z",
    "author_association": "MEMBER",
    "body": "+1 on culling being the culprit as I've been looking at this as well.\r\n\r\nI don't think we can go with the first option because culling could be taking place on an entirely different server than where the sessions are managed.  This is the case with Kernel/Enterprise Gateway - which proxies the kernel management to a different server via NB2KG.\r\n\r\nI was thinking more along the lines of combining the [`session_exists()` and `get_session()`](https://github.com/jupyter/notebook/blob/master/notebook/services/sessions/handlers.py#L65-L67) calls into one that can return `None`, then make the `else:` case a check on that return value - which creates the new session if `None`.\r\n\r\nI believe `get_session()`could just be extended with an option that indicates a dangling session be removed.  This parameter would, of course, default to today's behavior, but when present would perform the cleanup that `row_to_model()` does today.  `row_to_model()` would then not perform any cleanup, but could still raise KeyError to preserve functionality in `list_sessions()`.\r\n\r\nIf this sounds okay to others, I'd be happy to submit a PR.",
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/jupyter/notebook/issues/comments/439094745",
    "html_url": "https://github.com/jupyter/notebook/issues/4209#issuecomment-439094745",
    "issue_url": "https://api.github.com/repos/jupyter/notebook/issues/4209",
    "id": 439094745,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQzOTA5NDc0NQ==",
    "user": {
      "login": "glortho",
      "id": 526284,
      "node_id": "MDQ6VXNlcjUyNjI4NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/526284?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/glortho",
      "html_url": "https://github.com/glortho",
      "followers_url": "https://api.github.com/users/glortho/followers",
      "following_url": "https://api.github.com/users/glortho/following{/other_user}",
      "gists_url": "https://api.github.com/users/glortho/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/glortho/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/glortho/subscriptions",
      "organizations_url": "https://api.github.com/users/glortho/orgs",
      "repos_url": "https://api.github.com/users/glortho/repos",
      "events_url": "https://api.github.com/users/glortho/events{/privacy}",
      "received_events_url": "https://api.github.com/users/glortho/received_events",
      "type": "User",
      "site_admin": true
    },
    "created_at": "2018-11-15T16:09:31Z",
    "updated_at": "2018-11-15T16:09:31Z",
    "author_association": "NONE",
    "body": "Thank you kindly for your attention to this @kevin-bates. I'm not very familiar with the codebase, but an option for automatically creating a new session sounds good.\r\n\r\nI don't suppose you have suggestions for a workaround in the meantime, do you? We have one interface into notebooks where we could conceivably preflight the session post, but all ears for any other ideas!",
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/jupyter/notebook/issues/comments/439116891",
    "html_url": "https://github.com/jupyter/notebook/issues/4209#issuecomment-439116891",
    "issue_url": "https://api.github.com/repos/jupyter/notebook/issues/4209",
    "id": 439116891,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQzOTExNjg5MQ==",
    "user": {
      "login": "kevin-bates",
      "id": 22599560,
      "node_id": "MDQ6VXNlcjIyNTk5NTYw",
      "avatar_url": "https://avatars.githubusercontent.com/u/22599560?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/kevin-bates",
      "html_url": "https://github.com/kevin-bates",
      "followers_url": "https://api.github.com/users/kevin-bates/followers",
      "following_url": "https://api.github.com/users/kevin-bates/following{/other_user}",
      "gists_url": "https://api.github.com/users/kevin-bates/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/kevin-bates/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/kevin-bates/subscriptions",
      "organizations_url": "https://api.github.com/users/kevin-bates/orgs",
      "repos_url": "https://api.github.com/users/kevin-bates/repos",
      "events_url": "https://api.github.com/users/kevin-bates/events{/privacy}",
      "received_events_url": "https://api.github.com/users/kevin-bates/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-11-15T17:12:06Z",
    "updated_at": "2018-11-15T17:12:06Z",
    "author_association": "MEMBER",
    "body": "I can't think of any workarounds that don't require code changes - aside from disabling culling - which doesn't appear to be an option for you. ",
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/jupyter/notebook/issues/comments/439246668",
    "html_url": "https://github.com/jupyter/notebook/issues/4209#issuecomment-439246668",
    "issue_url": "https://api.github.com/repos/jupyter/notebook/issues/4209",
    "id": 439246668,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQzOTI0NjY2OA==",
    "user": {
      "login": "kevin-bates",
      "id": 22599560,
      "node_id": "MDQ6VXNlcjIyNTk5NTYw",
      "avatar_url": "https://avatars.githubusercontent.com/u/22599560?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/kevin-bates",
      "html_url": "https://github.com/kevin-bates",
      "followers_url": "https://api.github.com/users/kevin-bates/followers",
      "following_url": "https://api.github.com/users/kevin-bates/following{/other_user}",
      "gists_url": "https://api.github.com/users/kevin-bates/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/kevin-bates/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/kevin-bates/subscriptions",
      "organizations_url": "https://api.github.com/users/kevin-bates/orgs",
      "repos_url": "https://api.github.com/users/kevin-bates/repos",
      "events_url": "https://api.github.com/users/kevin-bates/events{/privacy}",
      "received_events_url": "https://api.github.com/users/kevin-bates/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-11-16T01:08:38Z",
    "updated_at": "2018-11-16T01:08:38Z",
    "author_association": "MEMBER",
    "body": "I should have something to take for a spin by tomorrow afternoon (PST).",
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/jupyter/notebook/issues/comments/439260107",
    "html_url": "https://github.com/jupyter/notebook/issues/4209#issuecomment-439260107",
    "issue_url": "https://api.github.com/repos/jupyter/notebook/issues/4209",
    "id": 439260107,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQzOTI2MDEwNw==",
    "user": {
      "login": "glortho",
      "id": 526284,
      "node_id": "MDQ6VXNlcjUyNjI4NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/526284?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/glortho",
      "html_url": "https://github.com/glortho",
      "followers_url": "https://api.github.com/users/glortho/followers",
      "following_url": "https://api.github.com/users/glortho/following{/other_user}",
      "gists_url": "https://api.github.com/users/glortho/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/glortho/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/glortho/subscriptions",
      "organizations_url": "https://api.github.com/users/glortho/orgs",
      "repos_url": "https://api.github.com/users/glortho/repos",
      "events_url": "https://api.github.com/users/glortho/events{/privacy}",
      "received_events_url": "https://api.github.com/users/glortho/received_events",
      "type": "User",
      "site_admin": true
    },
    "created_at": "2018-11-16T02:24:40Z",
    "updated_at": "2018-11-16T02:24:40Z",
    "author_association": "NONE",
    "body": "Awesome Kevin!\n\nOn Thu, Nov 15, 2018 at 20:08 Kevin Bates <notifications@github.com> wrote:\n\n> I should have something to take for a spin by tomorrow afternoon (PST).\n>\n> —\n> You are receiving this because you authored the thread.\n> Reply to this email directly, view it on GitHub\n> <https://github.com/jupyter/notebook/issues/4209#issuecomment-439246668>,\n> or mute the thread\n> <https://github.com/notifications/unsubscribe-auth/AAgHzJHYjZ9tiLQgy0PSQOB6ESbb9YOkks5uvhAcgaJpZM4Yb2nP>\n> .\n>\n",
    "performed_via_github_app": null
  }
]
